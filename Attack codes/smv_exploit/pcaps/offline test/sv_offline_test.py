from scapy.all import rdpcap, wrpcap
import random

def merge_pcaps(pcap1_file, pcap2_file, output_file, min_gap=70, max_gap=130):
    # Read the pcap files
    pcap1 = rdpcap(pcap1_file)
    pcap2 = rdpcap(pcap2_file)

    merged_packets = []
    pcap2_index = 0

    for i, packet in enumerate(pcap1):
        merged_packets.append(packet)

        # Check if we need to insert packets from pcap2
        if pcap2_index < len(pcap2) and i % random.randint(min_gap, max_gap) == 0:
            # Insert one packet from pcap2
            merged_packets.append(pcap2[pcap2_index])
            pcap2_index += 1

    # If there are still packets left in pcap2, append them to the end
    while pcap2_index < len(pcap2):
        merged_packets.append(pcap2[pcap2_index])
        pcap2_index += 1

    # Save the merged pcap file
    wrpcap(output_file, merged_packets)
    print(f'Merged {len(pcap1)} packets from {pcap1_file} and {len(pcap2)} packets from {pcap2_file} to {output_file}')

# Usage example
pcap1_file = 'GG_SV_Train_Data.pcapng'
pcap2_file = 'sv_offline_test2.pcapng'
output_file = 'sv_seq_smpcnt.pcapng'

merge_pcaps(pcap1_file, pcap2_file, output_file)
