from scapy.all import *
from struct import pack 
from scapy.layers.l2 import Ether

# Define the SV Packet Layer
class SV(Packet):
    name = "sv"
    fields_desc = [
        XShortField("appid", 0),
        XShortField("length", 8),
        XShortField("reserved1", 0),
        XShortField("reserved2", 0),
    ]

    def post_build(self, packet, payload):
        sv_pdu_length = len(packet) + len(payload)
        packet = packet[:2] + pack('!H', sv_pdu_length) + packet[4:]
        return packet + payload
    
# Bind the SV layer to the Ethernet layer
bind_layers(Ether, SV, type=0x88ba)


