from scapy.all import rdpcap, wrpcap, Ether

from m2 import *    



input_pcap = "C:/Users/Shaheem Mushtaq/Desk env/Work ðŸ’¼/Internship/Attack codes/smv_exploit/SV_Normal_Traffic.cap"
output_pcap = "test4.pcapng"
new_svID = "5001"
new_smpCnt = '\x01\x19'


# Read packets from input pcap file
pcap_packets = rdpcap(input_pcap)

packet = pcap_packets[0]  
# Modify svID and smpCnt fields
mod_packet = packet.copy()

mod_packet.show()


print(f"Original packet {'*'* 20 }")
print(f"svID : {mod_packet[SV].svID}")
print(f"smpCnt : {mod_packet[SV].smpCnt}")
print(f"SV layer length : {mod_packet[SV].Length}")

# mod_packet[SV].show()


mod_packet[SV].svID = new_svID
mod_packet[SV].smpCnt = new_smpCnt
mod_packet[SV].Length = len(new_svID) + len(new_smpCnt) + 200


print(f"Modified packet {'*'* 20 }")
print(f"svID : {mod_packet[SV].svID}")
print(f"smpCnt : {mod_packet[SV].smpCnt}")
print(f"SV layer length : {mod_packet[SV].Length}")

mod_packet.show()

# print(f"Original packet length : {len(packet)}")
# print(f"Modified packet length : {len(mod_packet)}")

# print(f"Asdu length : {len(mod_packet[ASDU])}")
# print(f"SV layer length : {len(mod_packet[SV])}")
# wrpcap(output_pcap, mod_packet)
