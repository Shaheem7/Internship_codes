from scapy.all import *
from scapy.contrib.iec61850 import SMV

def modify_smv_packet(packet):
    # Assuming 'packet' is an IEC 61850 SMV packet
    # Modify the fields as needed
    if SMV in packet:
        smv_layer = packet[SMV]
        # Example modifications (you need to adjust based on your requirements)
        smv_layer.show()
        smv_layer.fields['savPdu'] = b'Modified Data'  # Modify as needed
        # More modifications can be done here
        smv_layer.show()
    return packet

def main():
    # Read packets from a pcap file or capture live packets (for demonstration, we use sniff)
    packets = sniff(count=10)  # Adjust count and other parameters as needed

    for packet in packets:
        if SMV in packet:
            print("Original Packet:")
            packet.show()

            modified_packet = modify_smv_packet(packet)
            print("Modified Packet:")
            modified_packet.show()

            # Send the modified packet (adjust the interface as needed)
            sendp(modified_packet, iface='eth0')

if __name__ == "__main__":
    main()
